# 什么是Pgpool-II？

Pgpool-II管理一个PostgreSQL服务器池，以实现单个PostgreSQL安装所不具备的一些功能。这些功能包括：

- 高可用性
	Pgpool-II通过使用多个PostgreSQL服务器提供高可用性（HA）功能，从而自动从服务器池中删除损坏的服务器以继续数据库任务。这被称为自动故障转移。此外，Pgpool-II还为Pgpool-II本身提供了一个HA功能，称为看门狗（有关更多详细信息，请参阅第4章）。此外，Pgpool-II采用复杂的仲裁算法来避免误报错误和分裂大脑问题，使整个HA系统高度可靠。详见第5.15.6节。

- 负载平衡
	Pgpool-II将读取查询分布在多个PostgreSQL服务器上，以获得更高的性能。此功能称为负载平衡。写查询被发送到主服务器（在流式复制模式下）或所有服务器（在本机复制模式和快照隔离模式下）。有关这些模式的更多详细信息，请参阅第3.3.2节。在任何情况下，Pgpool-II都会自动区分读取查询和写入查询。

除了这些基本功能外，Pgpool-II还提供了有用的功能，例如：

- 连接池
	Pgpool-II维护与PostgreSQL服务器的已建立连接，并在出现具有相同属性（即用户名、数据库、协议版本和其他连接参数，如果有的话）的新连接时重用它们。它降低了连接开销，提高了系统的整体吞吐量。

- 在线恢复
	Pgpool-II可以通过执行一个命令来执行数据库节点的在线恢复。当在线恢复与自动故障转移一起使用时，通过故障转移分离的节点可以自动连接为备用节点。也可以同步和附加新的PostgreSQL服务器。

- 限制超出连接数
	PostgreSQL的并发连接的最大数量是有限制的，当达到这个数量时，新的连接会被拒绝。然而，提高连接的最大数量会增加资源消耗，并对整体系统性能产生负面影响。Pgpool-II对连接的最大数量也有限制，但额外的连接将被排队，而不是立即返回错误。但是，您可以配置为在超过连接限制（4.1或更高版本）时返回错误。

- 看门狗
	看门狗可以协调多个Pgpool-II，创建一个强大的集群系统，避免单点故障或分裂大脑。为了避免大脑分裂，你需要至少3个Pgpool-II节点。看门狗可以对其他pgpool-II节点执行生命检查，以检测pgpool-II的故障。如果活动Pgpool-II发生故障，备用Pgpool-II可以升级为活动，并接管虚拟IP。

- 内存查询缓存
	内存中的查询缓存允许保存一对SELECT语句及其结果。如果输入相同的SELECT，Pgpool-II将从缓存中返回值。由于不涉及SQL解析或PostgreSQL访问，因此使用内存缓存非常快。另一方面，在某些情况下，它可能比正常路径慢，因为它增加了存储缓存数据的一些开销。

Pgpool-II使用PostgreSQL的后端和前端协议，并在后端和前端之间中继消息。因此，数据库应用程序（前端）认为Pgpool-II是实际的PostgreSQL服务器，而服务器（后端）将Pgpool-II视为其客户端之一。因为Pgpool-II对服务器和客户端都是透明的，所以现有的数据库应用程序几乎可以在不更改源代码的情况下与Pgpool-II一起使用。

Pgpool-II适用于Linux、FreeBSD和大多数类UNIX架构。不支持Windows。支持的PostgreSQL服务器版本为7.4及更高版本（某些功能可能不适用于旧版本的PostgreSQL）。您还必须确保所有PostgreSQL服务器都使用相同的主版本。除此之外，我们不建议将不同的PostgreSQL安装与不同的构建选项混合使用：包括是否支持SSL、是否使用--disable整数日期时间、不同的块大小。这些可能会影响Pgpool-II的部分功能。PostgreSQL次要版本的差异通常不是问题。然而，我们不会测试所有次要版本，我们建议使用完全相同的PostgreSQL次要版本。

通过Pgpool-II使用SQL有一些限制。有关更多详细信息，请参阅限制。